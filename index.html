<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let chart;
let currentRate=0;

async function fetchRate(){
try{
const res=await fetch("https://api.frankfurter.app/latest?from=CZK&to=AED");
const data=await res.json();
currentRate=data.rates.AED;
document.getElementById("rate").innerText="Aktuální kurz: 1 CZK = "+currentRate.toFixed(4)+" AED";
calculate();
}catch(e){
document.getElementById("rate").innerText="Nelze načíst kurz";
}
}

function calculate(){
const amount=document.getElementById("amount").value;
document.getElementById("result").innerText=(amount*currentRate).toFixed(2)+" AED";
}

async function loadHistory(days,btn){
document.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");

const end=new Date();
const start=new Date();
start.setDate(end.getDate()-days);

const format=d=>d.toISOString().split("T")[0];

const url=`https://api.frankfurter.app/${format(start)}..${format(end)}?from=CZK&to=AED`;

const res=await fetch(url);
const data=await res.json();

const labels=Object.keys(data.rates);
const values=labels.map(date=>data.rates[date].AED);

if(chart)chart.destroy();

chart=new Chart(document.getElementById("chart"),{
type:"line",
data:{labels:labels,datasets:[{data:values,tension:.3,fill:false}]},
options:{responsive:true,plugins:{legend:{display:false}}}
});
}

document.getElementById("amount").addEventListener("input",calculate);

fetchRate();
loadHistory(7,document.querySelector(".active"));
setInterval(fetchRate,60000);
</script>
